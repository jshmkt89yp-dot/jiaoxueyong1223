<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¥ºå­é¦…è°ƒé…æ¸¸æˆ - æŠŠå­—å¥ç»ƒä¹ ï¼ˆæ”¹è¿›ç‰ˆï¼‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f8f3e9;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23f8f3e9"/><path d="M0,50 Q25,40 50,50 T100,50 L100,100 L0,100 Z" fill="%23f0e6d2" opacity="0.3"/></svg>');
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #d32f2f;
            border-radius: 15px;
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .role-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .role-btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .role-btn:hover {
            background-color: #388e3c;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .role-btn.active {
            background-color: #d32f2f;
        }
        
        .game-area {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .section {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            flex: 1;
            min-width: 300px;
        }
        
        .section-title {
            font-size: 1.5rem;
            color: #d32f2f;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ffcdd2;
        }
        
        .ingredients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .ingredient-item {
            background-color: #fff9f9;
            border-radius: 10px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .ingredient-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            border-color: #d32f2f;
        }
        
        .ingredient-item.selected {
            background-color: #ffebee;
            border-color: #d32f2f;
        }
        
        .ingredient-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            border-radius: 50%;
            background-color: white;
        }
        
        .ingredient-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .ingredient-pinyin {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .ingredient-desc {
            font-size: 0.8rem;
            color: #888;
        }
        
        .sentence-input-area {
            margin-top: 20px;
        }
        
        .selected-ingredients {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #fff9f9;
            border-radius: 8px;
        }
        
        .selected-ingredient-tag {
            display: flex;
            align-items: center;
            padding: 5px 10px;
            background-color: #ffcdd2;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .selected-ingredient-tag .remove-btn {
            margin-left: 5px;
            cursor: pointer;
            color: #d32f2f;
        }
        
        .multiple-choice-area {
            margin-top: 20px;
        }
        
        .question {
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: bold;
            color: #d32f2f;
        }
        
        .choice-item {
            display: block;
            margin-bottom: 10px;
            padding: 12px;
            background-color: #f5f5f5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        
        .choice-item:hover {
            background-color: #e8f5e9;
            border-color: #4caf50;
        }
        
        .choice-item.selected {
            background-color: #c8e6c9;
            border-color: #2e7d32;
        }
        
        .choice-text {
            margin-left: 10px;
        }
        
        .input-container {
            position: relative;
            margin-bottom: 15px;
        }
        
        #sentence-input {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            transition: border-color 0.3s;
        }
        
        #sentence-input:focus {
            outline: none;
            border-color: #d32f2f;
        }
        
        .input-hint {
            position: absolute;
            top: -10px;
            left: 10px;
            background: white;
            padding: 0 5px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .hint {
            background-color: #e8f5e9;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }
        
        .hint-title {
            color: #2e7d32;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .example {
            font-style: italic;
            color: #555;
            margin-top: 8px;
            background-color: #f1f8e9;
            padding: 8px;
            border-radius: 5px;
            border-left: 3px solid #8bc34a;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 25px;
            background-color: #d32f2f;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background-color: #b71c1c;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .bowl-container {
            text-align: center;
            margin-top: 20px;
        }
        
        #bowl {
            width: 200px;
            height: 200px;
            background-color: #fff8e1;
            border-radius: 50%;
            margin: 0 auto 20px;
            position: relative;
            border: 10px solid #ffd54f;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1);
        }
        
        .ingredient-in-bowl {
            position: absolute;
            border-radius: 50%;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .result-text {
            font-size: 1.3rem;
            margin-top: 20px;
            min-height: 60px;
            padding: 15px;
            background-color: #fff;
            border-radius: 10px;
            border-left: 5px solid #d32f2f;
        }
        
        .progress {
            margin-top: 20px;
            text-align: center;
        }
        
        .progress-text {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #4caf50;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .instructions {
            background-color: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .instructions h3 {
            color: #1565c0;
            margin-bottom: 10px;
        }
        
        .instructions ol {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .feedback {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
            min-height: 60px;
        }
        
        .feedback.correct {
            background-color: #e8f5e9;
            color: #2e7d32;
            opacity: 1;
        }
        
        .feedback.incorrect {
            background-color: #ffebee;
            color: #c62828;
            opacity: 1;
        }
        
        .reset-btn {
            background-color: #ff9800;
            margin-left: 10px;
        }
        
        .reset-btn:hover {
            background-color: #ef6c00;
        }
        
        .grammar-tips {
            background-color: #f3e5f5;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .grammar-tips h4 {
            color: #7b1fa2;
            margin-bottom: 10px;
        }
        
        .grammar-tips ul {
            padding-left: 20px;
        }
        
        .grammar-tips li {
            margin-bottom: 8px;
        }
        
        .score-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #e1f5fe;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .score-item {
            text-align: center;
        }
        
        .score-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #d32f2f;
        }
        
        .score-label {
            font-size: 0.9rem;
            color: #555;
        }
        
        .vocabulary-list {
            background-color: #fff3e0;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .vocabulary-list h4 {
            color: #f57c00;
            margin-bottom: 10px;
        }
        
        .vocab-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .vocab-table th, .vocab-table td {
            border: 1px solid #ffcc80;
            padding: 8px;
            text-align: left;
        }
        
        .vocab-table th {
            background-color: #ffe0b2;
        }
        
        /* æ•™å¸ˆç«¯æ ·å¼ */
        .teacher-view {
            display: none;
        }
        
        .student-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .student-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #2196f3;
        }
        
        .student-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .student-progress {
            margin-top: 10px;
        }
        
        .student-ingredients {
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .student-ingredients ul {
            padding-left: 20px;
            margin-top: 5px;
        }
        
        .student-ingredients li {
            margin-bottom: 5px;
        }
        
        .teacher-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .teacher-btn {
            padding: 10px 20px;
            background-color: #2196f3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .teacher-btn:hover {
            background-color: #0d8bf2;
        }
        
        #class-code {
            font-size: 1.5rem;
            font-weight: bold;
            color: #d32f2f;
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background-color: #ffebee;
            border-radius: 5px;
        }
        
        .class-overview {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .class-overview h4 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .student-input {
            margin-bottom: 20px;
        }
        
        .student-input label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .student-input input {
            width: 100%;
            padding: 10px;
            font-size: 1.1rem;
            border: 2px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .connection-status {
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .connection-status.connected {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .connection-status.disconnected {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .class-code-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .class-code-input input {
            flex: 1;
        }
        
        @media (max-width: 768px) {
            .game-area {
                flex-direction: column;
            }
            
            .section {
                width: 100%;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .score-area {
                flex-direction: column;
                gap: 15px;
            }
            
            .ingredients-grid {
                grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            }
            
            .student-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>é¥ºå­é¦…è°ƒé…æ¸¸æˆ</h1>
            <p class="subtitle">é€šè¿‡è°ƒé…é¥ºå­é¦…å­¦ä¹ ä½¿ç”¨"æŠŠ"å­—å¥ï¼ˆä½ç§»æŠŠå­—å¥ï¼‰</p>
        </header>
        
        <div class="role-selector">
            <button class="role-btn active" id="student-btn">å­¦ç”Ÿç«¯</button>
            <button class="role-btn" id="teacher-btn">æ•™å¸ˆç«¯</button>
        </div>
        
        <!-- å­¦ç”Ÿç«¯ -->
        <div id="student-view">
            <div class="instructions">
                <h3>æ¸¸æˆè¯´æ˜</h3>
                <ol>
                    <li>è¯·è¾“å…¥ä½ çš„åå­—å’Œæ•™å¸ˆæä¾›çš„ç­çº§ä»£ç </li>
                    <li>ä»å·¦ä¾§é€‰æ‹©1-3ç§é¥ºå­åŸæ–™ï¼ˆç‚¹å‡»å›¾ç‰‡å¯ä»¥å¤šé€‰ï¼‰</li>
                    <li>ä»é€‰æ‹©é¢˜ä¸­é€‰æ‹©æ­£ç¡®çš„"æŠŠ"å­—å¥æè¿°ä½ å¦‚ä½•å¤„ç†è¿™äº›åŸæ–™</li>
                    <li>ç‚¹å‡»"æ·»åŠ åˆ°é¦…æ–™ä¸­"æŒ‰é’®ï¼Œå¦‚æœå¥å­æ­£ç¡®ï¼ŒåŸæ–™ä¼šåŠ å…¥åˆ°ç¢—ä¸­</li>
                    <li>å°è¯•æ·»åŠ è‡³å°‘5ç§åŸæ–™æ¥å®Œæˆé¥ºå­é¦…è°ƒé…</li>
                    <li><strong>æ³¨æ„ï¼š</strong>å¿…é¡»é€‰æ‹©æ­£ç¡®çš„"æŠŠ"å­—å¥</li>
                </ol>
            </div>
            
            <div class="student-input">
                <div class="connection-status" id="student-connection-status">æœªè¿æ¥</div>
                <label for="student-name-input">è¯·è¾“å…¥ä½ çš„åå­—ï¼š</label>
                <input type="text" id="student-name-input" placeholder="ä¾‹å¦‚ï¼šå°æ˜ã€ç›ä¸½ã€å¤§å«">
                
                <div class="class-code-input">
                    <input type="text" id="class-code-input" placeholder="è¯·è¾“å…¥æ•™å¸ˆæä¾›çš„ç­çº§ä»£ç ">
                    <button class="btn" id="connect-btn">è¿æ¥ç­çº§</button>
                </div>
                
                <button class="btn" id="start-game-btn" disabled>å¼€å§‹æ¸¸æˆ</button>
            </div>
            
            <div id="game-content" style="display: none;">
                <div class="game-area">
                    <div class="section">
                        <h2 class="section-title">é€‰æ‹©é¥ºå­åŸæ–™ï¼ˆå¯å¤šé€‰ï¼‰</h2>
                        <p>ç‚¹å‡»é€‰æ‹©1-3ç§ä½ æƒ³åŠ å…¥é¥ºå­é¦…çš„é£Ÿæï¼ˆæ‰€æœ‰è¯æ±‡éƒ½åœ¨HSK4çº§èŒƒå›´å†…ï¼‰ï¼š</p>
                        
                        <div class="ingredients-grid" id="ingredients-container">
                            <!-- åŸæ–™å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                        
                        <div class="selected-ingredients" id="selected-ingredients-display" style="display: none;">
                            <h4>å·²é€‰æ‹©çš„åŸæ–™ï¼š</h4>
                            <!-- å·²é€‰æ‹©çš„åŸæ–™å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                        </div>
                        
                        <div class="multiple-choice-area" id="multiple-choice-area" style="display: none;">
                            <div class="question">è¯·é€‰æ‹©æ­£ç¡®çš„"æŠŠ"å­—å¥ï¼š</div>
                            <!-- é€‰æ‹©é¢˜å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                        
                        <div class="feedback" id="feedback"></div>
                        
                        <button class="btn" id="add-btn" disabled>æ·»åŠ åˆ°é¦…æ–™ä¸­</button>
                        <button class="btn reset-btn" id="reset-btn">é‡æ–°å¼€å§‹</button>
                        
                        <div class="progress">
                            <div class="progress-text">é¦…æ–™è°ƒé…è¿›åº¦: <span id="progress-count">0</span>/8</div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill"></div>
                            </div>
                        </div>
                        
                        <div class="score-area">
                            <div class="score-item">
                                <div class="score-value" id="score-value">0</div>
                                <div class="score-label">å½“å‰å¾—åˆ†</div>
                            </div>
                            <div class="score-item">
                                <div class="score-value" id="correct-count">0</div>
                                <div class="score-label">æ­£ç¡®å¥å­</div>
                            </div>
                            <div class="score-item">
                                <div class="score-value" id="attempt-count">0</div>
                                <div class="score-label">å°è¯•æ¬¡æ•°</div>
                            </div>
                        </div>
                        
                        <div class="grammar-tips">
                            <h4>"æŠŠ"å­—å¥è¯­æ³•æç¤ºï¼ˆé€‚åˆHSK4çº§æ°´å¹³ï¼‰</h4>
                            <ul>
                                <li><strong>åŸºæœ¬ç»“æ„ï¼š</strong>ä¸»è¯­ + æŠŠ + å®¾è¯­ + åŠ¨è¯ + å…¶ä»–æˆåˆ†</li>
                                <li><strong>ä½ç§»æŠŠå­—å¥ï¼š</strong>è¡¨ç¤ºç‰©ä½“ä½ç½®ç§»åŠ¨ï¼Œå¸¸ç”¨åŠ¨è¯ï¼šæ”¾ã€åŠ ã€å€’ã€åˆ‡ã€æ‰“</li>
                                <li><strong>å¸¸ç”¨åœ°ç‚¹è¯ï¼š</strong>ç¢—é‡Œã€ç›†ä¸­ã€é”…é‡Œã€æ¡Œå­ä¸Šã€ä¸­é—´ã€ä¸€èµ·</li>
                                <li><strong>ä¾‹å¥ï¼š</strong>æˆ‘æŠŠé¸¡è›‹æ‰“åˆ°ç¢—é‡Œã€‚/ ä»–æŠŠæ²¹å€’è¿›ç›†ä¸­ã€‚/ å¦ˆå¦ˆæŠŠè‚‰åˆ‡ç¢ã€‚</li>
                                <li><strong>æ³¨æ„ï¼š</strong>"æŠŠ"å­—å¥çš„å®¾è¯­å¿…é¡»æ˜¯å·²çŸ¥çš„ã€ç¡®å®šçš„</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2 class="section-title">é¦…æ–™è°ƒé…ç»“æœ</h2>
                        <p>çœ‹çœ‹ä½ è°ƒé…çš„é¥ºå­é¦…ï¼š</p>
                        
                        <div class="bowl-container">
                            <div id="bowl">
                                <!-- åŸæ–™å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                            </div>
                            <div class="result-text" id="result-text">
                                ç¢—æ˜¯ç©ºçš„ï¼Œè¯·å¼€å§‹æ·»åŠ åŸæ–™...
                            </div>
                        </div>
                        
                        <div class="hint">
                            <div class="hint-title">å·²æ·»åŠ çš„åŸæ–™å’Œå¥å­</div>
                            <div id="added-ingredients-list"></div>
                        </div>
                        
                        <div class="grammar-tips">
                            <h4>ä½ çš„å­¦ä¹ æˆæœ</h4>
                            <p>æ¯æˆåŠŸæ·»åŠ ä¸€ç§åŸæ–™ï¼Œè¡¨ç¤ºä½ æ­£ç¡®ä½¿ç”¨äº†ä¸€ä¸ª"æŠŠ"å­—å¥ï¼</p>
                            <p>å°è¯•ä½¿ç”¨ä¸åŒçš„ä¸»è¯­ï¼ˆæˆ‘ã€ä»–ã€å¦ˆå¦ˆã€å¨å¸ˆç­‰ï¼‰å’Œä¸åŒçš„åŠ¨è¯ï¼ˆæ”¾ã€åŠ ã€å€’ã€åˆ‡ã€æ‰“ç­‰ï¼‰æ¥é€ å¥å­ã€‚</p>
                            <div id="achievement-display">
                                <p><strong>å½“å‰æˆå°±ï¼š</strong>åˆçº§é¥ºå­å¸ˆå‚…</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ•™å¸ˆç«¯ -->
        <div id="teacher-view" class="teacher-view">
            <div class="instructions">
                <h3>æ•™å¸ˆæ§åˆ¶é¢æ¿</h3>
                <p>æ¬¢è¿ä½¿ç”¨æ•™å¸ˆç«¯ï¼æ‚¨å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹æ‰€æœ‰å­¦ç”Ÿçš„é¥ºå­é¦…è°ƒé…æƒ…å†µã€‚</p>
                <div class="class-code-input">
                    <input type="text" id="teacher-class-code-input" placeholder="è¯·è¾“å…¥ç­çº§ä»£ç ">
                    <button class="btn" id="teacher-connect-btn">åˆ›å»º/è¿æ¥ç­çº§</button>
                </div>
                <div id="class-code-display-area" style="display: none;">
                    <p><strong>ç­çº§ä»£ç ï¼š</strong> <span id="class-code-display">DUMBLING-2023</span></p>
                    <p>è¯·å°†ä¸Šé¢çš„ç­çº§ä»£ç å‘Šè¯‰å­¦ç”Ÿï¼Œå­¦ç”Ÿéœ€è¦åœ¨æ¸¸æˆå¼€å§‹æ—¶è¾“å…¥è¿™ä¸ªä»£ç ã€‚</p>
                </div>
            </div>
            
            <div class="teacher-controls" id="teacher-controls" style="display: none;">
                <button class="teacher-btn" id="refresh-btn">åˆ·æ–°å­¦ç”Ÿæ•°æ®</button>
                <button class="teacher-btn" id="clear-all-btn">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
            </div>
            
            <div class="class-overview" id="class-overview" style="display: none;">
                <h4>ç­çº§æ¦‚å†µ</h4>
                <p>å­¦ç”Ÿæ€»æ•°ï¼š<span id="student-count">0</span></p>
                <p>å·²å®Œæˆå­¦ç”Ÿï¼š<span id="completed-count">0</span></p>
                <p>å¹³å‡å¾—åˆ†ï¼š<span id="average-score">0</span></p>
            </div>
            
            <div class="student-list" id="student-list-container">
                <!-- å­¦ç”Ÿå¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                <p id="no-students-msg">è¯·å…ˆåˆ›å»ºæˆ–è¿æ¥ç­çº§...</p>
            </div>
        </div>
        
        <div class="instructions">
            <h3>æ•™å­¦å»ºè®®</h3>
            <p>è¿™ä¸ªæ¸¸æˆé€‚åˆHSK4çº§æ°´å¹³çš„ç•™å­¦ç”Ÿã€‚æ•™å¸ˆå¯ä»¥ï¼š</p>
            <ol>
                <li>å…ˆè®²è§£"æŠŠ"å­—å¥çš„åŸºæœ¬ç»“æ„å’Œç”¨æ³•</li>
                <li>æ¼”ç¤ºæ¸¸æˆç©æ³•ï¼Œå¼ºè°ƒè¦é€‰æ‹©æ­£ç¡®çš„"æŠŠ"å­—å¥</li>
                <li>è®©å­¦ç”Ÿåˆ†ç»„æˆ–ç‹¬ç«‹å®Œæˆæ¸¸æˆ</li>
                <li>åœ¨æ•™å¸ˆç«¯å±•ç¤ºå­¦ç”Ÿçš„æˆæœï¼Œåˆ†æå¸¸è§é”™è¯¯</li>
                <li>æ‰©å±•æ´»åŠ¨ï¼šè®©å­¦ç”Ÿå†™å‡ºå®Œæ•´çš„é¥ºå­åˆ¶ä½œè¿‡ç¨‹ï¼Œä½¿ç”¨å¤šä¸ª"æŠŠ"å­—å¥</li>
            </ol>
        </div>
    </div>

    <script>
        // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒlocalStorage
        function isLocalStorageSupported() {
            try {
                const testKey = '__test__';
                localStorage.setItem(testKey, testKey);
                localStorage.removeItem(testKey);
                return true;
            } catch (e) {
                console.warn('localStorage is not supported:', e);
                return false;
            }
        }
        
        // å…¨å±€å˜é‡
        let selectedIngredients = [];
        let addedIngredients = [];
        let score = 0;
        let correctCount = 0;
        let totalAttempts = 0;
        let studentName = "";
        let gameStarted = false;
        let classCode = "";
        let isConnected = false;
        let currentChoice = null;
        let storageSupported = isLocalStorageSupported();
        
        // åŸæ–™æ•°æ®ï¼ˆæ‰€æœ‰è¯æ±‡éƒ½åœ¨HSK4çº§èŒƒå›´å†…ï¼‰
        const ingredients = [
            { id: 1, name: "çŒªè‚‰", pinyin: "zhÅ« rÃ²u", emoji: "ğŸ¥©", desc: "ä¸»è¦è‚‰ç±»åŸæ–™", color: "#ffcdd2", prep: "åˆ‡ç¢" },
            { id: 2, name: "ç™½èœ", pinyin: "bÃ¡i cÃ i", emoji: "ğŸ¥¬", desc: "ç»å…¸è”¬èœåŸæ–™", color: "#c8e6c9", prep: "åˆ‡ç¢" },
            { id: 3, name: "é¸¡è›‹", pinyin: "jÄ« dÃ n", emoji: "ğŸ¥š", desc: "å¢åŠ é¦…æ–™å£æ„Ÿ", color: "#fff9c4", prep: "æ‰“æ•£" },
            { id: 4, name: "è‘±", pinyin: "cÅng", emoji: "ğŸ§…", desc: "è°ƒå‘³å¿…å¤‡", color: "#dcedc8", prep: "åˆ‡æœ«" },
            { id: 5, name: "ç›", pinyin: "yÃ¡n", emoji: "ğŸ§‚", desc: "è°ƒå‘³", color: "#f5f5f5", prep: "åŠ å…¥" },
            { id: 6, name: "æ²¹", pinyin: "yÃ³u", emoji: "ğŸ«™", desc: "å¢åŠ é¦™å‘³", color: "#ffcc80", prep: "å€’å…¥" },
            { id: 7, name: "å§œ", pinyin: "jiÄng", emoji: "ğŸ§„", desc: "å»è…¥è°ƒå‘³", color: "#ffecb3", prep: "åˆ‡æœ«" },
            { id: 8, name: "æ°´", pinyin: "shuÇ", emoji: "ğŸ’§", desc: "è°ƒèŠ‚æ¹¿åº¦", color: "#bbdefb", prep: "åŠ å…¥" }
        ];
        
        // é€‰æ‹©é¢˜ç”Ÿæˆæ•°æ®
        const subjects = ["æˆ‘", "å¦ˆå¦ˆ", "çˆ¸çˆ¸", "ä»–", "å¥¹", "æˆ‘ä»¬", "å¨å¸ˆ", "è€å¸ˆ"];
        const verbs = ["æ”¾", "åŠ ", "å€’", "åˆ‡", "æ‰“", "æ”¾", "åŠ ", "å€’"];
        const locations = ["ç¢—é‡Œ", "ç›†ä¸­", "é”…é‡Œ", "æ¡Œå­ä¸Š", "ä¸­é—´", "ä¸€èµ·"];
        
        // æˆå°±ç³»ç»Ÿ
        const achievements = [
            { level: 0, name: "åˆçº§é¥ºå­å¸ˆå‚…", minScore: 0 },
            { level: 1, name: "ä¸­çº§é¥ºå­å¸ˆå‚…", minScore: 10 },
            { level: 2, name: "é«˜çº§é¥ºå­å¸ˆå‚…", minScore: 20 },
            { level: 3, name: "é¥ºå­å¤§å¸ˆ", minScore: 30 },
            { level: 4, name: "é¥ºå­ä¹‹ç‹", minScore: 40 }
        ];
        
        // DOMå…ƒç´ 
        const studentView = document.getElementById('student-view');
        const teacherView = document.getElementById('teacher-view');
        const studentBtn = document.getElementById('student-btn');
        const teacherBtn = document.getElementById('teacher-btn');
        const studentNameInput = document.getElementById('student-name-input');
        const classCodeInput = document.getElementById('class-code-input');
        const connectBtn = document.getElementById('connect-btn');
        const startGameBtn = document.getElementById('start-game-btn');
        const gameContent = document.getElementById('game-content');
        const ingredientsContainer = document.getElementById('ingredients-container');
        const selectedIngredientsDisplay = document.getElementById('selected-ingredients-display');
        const multipleChoiceArea = document.getElementById('multiple-choice-area');
        const addBtn = document.getElementById('add-btn');
        const resetBtn = document.getElementById('reset-btn');
        const bowl = document.getElementById('bowl');
        const resultText = document.getElementById('result-text');
        const feedback = document.getElementById('feedback');
        const progressCount = document.getElementById('progress-count');
        const progressFill = document.getElementById('progress-fill');
        const addedIngredientsList = document.getElementById('added-ingredients-list');
        const scoreValue = document.getElementById('score-value');
        const correctCountElement = document.getElementById('correct-count');
        const attemptCountElement = document.getElementById('attempt-count');
        const achievementDisplay = document.getElementById('achievement-display');
        const studentConnectionStatus = document.getElementById('student-connection-status');
        
        // æ•™å¸ˆç«¯DOMå…ƒç´ 
        const teacherClassCodeInput = document.getElementById('teacher-class-code-input');
        const teacherConnectBtn = document.getElementById('teacher-connect-btn');
        const classCodeDisplayArea = document.getElementById('class-code-display-area');
        const classCodeDisplay = document.getElementById('class-code-display');
        const teacherControls = document.getElementById('teacher-controls');
        const classOverview = document.getElementById('class-overview');
        const refreshBtn = document.getElementById('refresh-btn');
        const clearAllBtn = document.getElementById('clear-all-btn');
        const studentListContainer = document.getElementById('student-list-container');
        const studentCountElement = document.getElementById('student-count');
        const completedCountElement = document.getElementById('completed-count');
        const averageScoreElement = document.getElementById('average-score');
        const noStudentsMsg = document.getElementById('no-students-msg');
        
        // è§’è‰²åˆ‡æ¢
        studentBtn.addEventListener('click', () => {
            studentView.style.display = 'block';
            teacherView.style.display = 'none';
            studentBtn.classList.add('active');
            teacherBtn.classList.remove('active');
        });
        
        teacherBtn.addEventListener('click', () => {
            studentView.style.display = 'none';
            teacherView.style.display = 'block';
            teacherBtn.classList.add('active');
            studentBtn.classList.remove('active');
        });
        
        // å­¦ç”Ÿè¿æ¥ç­çº§
        connectBtn.addEventListener('click', () => {
            studentName = studentNameInput.value.trim();
            classCode = classCodeInput.value.trim();
            
            if (!studentName) {
                showFeedback("è¯·è¾“å…¥ä½ çš„åå­—ï¼", false, 0, 'student');
                return;
            }
            
            if (!classCode) {
                showFeedback("è¯·è¾“å…¥ç­çº§ä»£ç ï¼", false, 0, 'student');
                return;
            }
            
            if (!storageSupported) {
                showFeedback("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬åœ°å­˜å‚¨ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½æ— æ³•ä½¿ç”¨", false, 0, 'student');
                isConnected = true;
                studentConnectionStatus.textContent = `å·²è¿æ¥åˆ°ç­çº§: ${classCode} (æ— å­˜å‚¨)`;
                studentConnectionStatus.className = 'connection-status connected';
                startGameBtn.disabled = false;
                showFeedback("æˆåŠŸè¿æ¥åˆ°ç­çº§ï¼(æ³¨æ„: æ•°æ®æ— æ³•ä¿å­˜)", true, 0, 'student');
                return;
            }
            
            // æ£€æŸ¥ç­çº§æ˜¯å¦å­˜åœ¨
            const classData = localStorage.getItem(`dumplingClass_${classCode}`);
            if (!classData) {
                showFeedback("ç­çº§ä»£ç ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥æˆ–è”ç³»è€å¸ˆï¼", false, 0, 'student');
                return;
            }
            
            isConnected = true;
            studentConnectionStatus.textContent = `å·²è¿æ¥åˆ°ç­çº§: ${classCode}`;
            studentConnectionStatus.className = 'connection-status connected';
            startGameBtn.disabled = false;
            showFeedback("æˆåŠŸè¿æ¥åˆ°ç­çº§ï¼", true, 0, 'student');
        });
        
        // æ•™å¸ˆåˆ›å»º/è¿æ¥ç­çº§
        teacherConnectBtn.addEventListener('click', () => {
            classCode = teacherClassCodeInput.value.trim();
            
            if (!classCode) {
                showFeedback("è¯·è¾“å…¥ç­çº§ä»£ç ï¼", false, 0, 'teacher');
                return;
            }
            
            if (!storageSupported) {
                showFeedback("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬åœ°å­˜å‚¨ï¼Œæ— æ³•ä¿å­˜ç­çº§æ•°æ®", false, 0, 'teacher');
                return;
            }
            
            // æ£€æŸ¥ç­çº§æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º
            let classData = localStorage.getItem(`dumplingClass_${classCode}`);
            if (!classData) {
                classData = JSON.stringify({
                    code: classCode,
                    created: new Date().toISOString(),
                    students: {}
                });
                localStorage.setItem(`dumplingClass_${classCode}`, classData);
                showFeedback("ç­çº§åˆ›å»ºæˆåŠŸï¼", true, 0, 'teacher');
            } else {
                showFeedback("ç­çº§è¿æ¥æˆåŠŸï¼", true, 0, 'teacher');
            }
            
            // æ˜¾ç¤ºç­çº§ä¿¡æ¯
            classCodeDisplay.textContent = classCode;
            classCodeDisplayArea.style.display = 'block';
            teacherControls.style.display = 'flex';
            classOverview.style.display = 'block';
            
            // åŠ è½½å­¦ç”Ÿæ•°æ®
            loadStudentData();
        });
        
        // å¼€å§‹æ¸¸æˆ
        startGameBtn.addEventListener('click', () => {
            if (!isConnected) {
                showFeedback("è¯·å…ˆè¿æ¥åˆ°ç­çº§ï¼", false, 0, 'student');
                return;
            }
            
            gameStarted = true;
            gameContent.style.display = 'block';
            startGameBtn.disabled = true;
            studentNameInput.disabled = true;
            classCodeInput.disabled = true;
            connectBtn.disabled = true;
            
            // åˆå§‹åŒ–åŸæ–™é€‰æ‹©åŒº
            initializeIngredients();
            
            // ä¿å­˜å­¦ç”Ÿä¿¡æ¯åˆ°ç­çº§æ•°æ®
            saveStudentData();
        });
        
        // åˆå§‹åŒ–åŸæ–™é€‰æ‹©åŒº
        function initializeIngredients() {
            ingredientsContainer.innerHTML = '';
            
            ingredients.forEach(ingredient => {
                const ingredientElement = document.createElement('div');
                ingredientElement.className = 'ingredient-item';
                ingredientElement.innerHTML = `
                    <div class="ingredient-icon">${ingredient.emoji}</div>
                    <div class="ingredient-name">${ingredient.name}</div>
                    <div class="ingredient-pinyin">${ingredient.pinyin}</div>
                    <div class="ingredient-desc">${ingredient.desc}</div>
                `;
                
                ingredientElement.addEventListener('click', () => {
                    // æ£€æŸ¥æ˜¯å¦å·²é€‰æ‹©
                    const isSelected = selectedIngredients.some(item => item.id === ingredient.id);
                    
                    if (isSelected) {
                        // å¦‚æœå·²é€‰æ‹©ï¼Œåˆ™å–æ¶ˆé€‰æ‹©
                        selectedIngredients = selectedIngredients.filter(item => item.id !== ingredient.id);
                        ingredientElement.classList.remove('selected');
                    } else {
                        // å¦‚æœæœªé€‰æ‹©ï¼Œæ£€æŸ¥æ˜¯å¦å·²é€‰æ‹©3ä¸ª
                        if (selectedIngredients.length >= 3) {
                            showFeedback("æœ€å¤šåªèƒ½é€‰æ‹©3ç§åŸæ–™ï¼", false, 0, 'student');
                            return;
                        }
                        
                        // æ·»åŠ é€‰æ‹©
                        selectedIngredients.push(ingredient);
                        ingredientElement.classList.add('selected');
                    }
                    
                    // æ›´æ–°å·²é€‰æ‹©åŸæ–™æ˜¾ç¤º
                    updateSelectedIngredientsDisplay();
                    
                    // å¦‚æœé€‰æ‹©äº†åŸæ–™ï¼Œç”Ÿæˆé€‰æ‹©é¢˜
                    if (selectedIngredients.length > 0) {
                        generateMultipleChoiceQuestions();
                        multipleChoiceArea.style.display = 'block';
                    } else {
                        multipleChoiceArea.style.display = 'none';
                        addBtn.disabled = true;
                    }
                });
                
                ingredientsContainer.appendChild(ingredientElement);
            });
        }
        
        // æ›´æ–°å·²é€‰æ‹©åŸæ–™æ˜¾ç¤º
        function updateSelectedIngredientsDisplay() {
            if (selectedIngredients.length === 0) {
                selectedIngredientsDisplay.style.display = 'none';
                return;
            }
            
            selectedIngredientsDisplay.style.display = 'block';
            selectedIngredientsDisplay.innerHTML = '<h4>å·²é€‰æ‹©çš„åŸæ–™ï¼š</h4>';
            
            selectedIngredients.forEach(ingredient => {
                const tag = document.createElement('div');
                tag.className = 'selected-ingredient-tag';
                tag.innerHTML = `
                    ${ingredient.emoji} ${ingredient.name}
                    <span class="remove-btn" data-id="${ingredient.id}">Ã—</span>
                `;
                selectedIngredientsDisplay.appendChild(tag);
            });
            
            // æ·»åŠ ç§»é™¤æŒ‰é’®çš„äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.remove-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const ingredientId = parseInt(e.target.getAttribute('data-id'));
                    selectedIngredients = selectedIngredients.filter(item => item.id !== ingredientId);
                    
                    // æ›´æ–°åŸæ–™é€‰æ‹©åŒºçš„æ˜¾ç¤º
                    document.querySelectorAll('.ingredient-item').forEach(item => {
                        const itemName = item.querySelector('.ingredient-name').textContent;
                        const ingredient = ingredients.find(ing => ing.name === itemName);
                        if (ingredient && selectedIngredients.some(sel => sel.id === ingredient.id)) {
                            item.classList.add('selected');
                        } else {
                            item.classList.remove('selected');
                        }
                    });
                    
                    updateSelectedIngredientsDisplay();
                    
                    if (selectedIngredients.length > 0) {
                        generateMultipleChoiceQuestions();
                        multipleChoiceArea.style.display = 'block';
                    } else {
                        multipleChoiceArea.style.display = 'none';
                        addBtn.disabled = true;
                    }
                });
            });
        }
        
        // ç”Ÿæˆé€‰æ‹©é¢˜
        function generateMultipleChoiceQuestions() {
            multipleChoiceArea.innerHTML = '';
            
            const question = document.createElement('div');
            question.className = 'question';
            question.textContent = 'è¯·é€‰æ‹©æ­£ç¡®çš„"æŠŠ"å­—å¥ï¼š';
            multipleChoiceArea.appendChild(question);
            
            // ç”Ÿæˆæ­£ç¡®å¥å­
            const correctSentence = generateCorrectSentence();
            
            // ç”Ÿæˆé”™è¯¯å¥å­
            const wrongSentences = [];
            while (wrongSentences.length < 3) {
                const wrongSentence = generateWrongSentence();
                if (wrongSentence !== correctSentence && !wrongSentences.includes(wrongSentence)) {
                    wrongSentences.push(wrongSentence);
                }
            }
            
            // åˆå¹¶æ‰€æœ‰å¥å­å¹¶éšæœºæ’åº
            const allSentences = [correctSentence, ...wrongSentences];
            shuffleArray(allSentences);
            
            // åˆ›å»ºé€‰æ‹©é¢˜
            allSentences.forEach((sentence, index) => {
                const choiceItem = document.createElement('div');
                choiceItem.className = 'choice-item';
                choiceItem.setAttribute('data-index', index);
                
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = 'sentence-choice';
                radio.id = `choice-${index}`;
                radio.value = sentence;
                
                const label = document.createElement('label');
                label.htmlFor = `choice-${index}`;
                label.innerHTML = `<span class="choice-text">${sentence}</span>`;
                
                choiceItem.appendChild(radio);
                choiceItem.appendChild(label);
                
                // æ·»åŠ é€‰æ‹©äº‹ä»¶
                choiceItem.addEventListener('click', () => {
                    // ç§»é™¤å…¶ä»–é€‰æ‹©
                    document.querySelectorAll('.choice-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    
                    // è®¾ç½®å½“å‰é€‰æ‹©
                    choiceItem.classList.add('selected');
                    currentChoice = sentence;
                    
                    // å¯ç”¨æ·»åŠ æŒ‰é’®
                    addBtn.disabled = false;
                });
                
                multipleChoiceArea.appendChild(choiceItem);
            });
        }
        
        // ç”Ÿæˆæ­£ç¡®å¥å­
        function generateCorrectSentence() {
            const subject = subjects[Math.floor(Math.random() * subjects.length)];
            const verb = verbs[Math.floor(Math.random() * verbs.length)];
            const location = locations[Math.floor(Math.random() * locations.length)];
            
            // æ„å»ºå®¾è¯­ï¼ˆå¤šä¸ªåŸæ–™ç”¨"å’Œ"è¿æ¥ï¼‰
            let object = '';
            if (selectedIngredients.length === 1) {
                object = selectedIngredients[0].name;
            } else {
                const names = selectedIngredients.map(ing => ing.name);
                object = names.slice(0, -1).join('ã€') + 'å’Œ' + names[names.length - 1];
            }
            
            // éšæœºé€‰æ‹©ä»‹è¯
            const prepositions = ['åˆ°', 'è¿›', 'åœ¨'];
            const preposition = prepositions[Math.floor(Math.random() * prepositions.length)];
            
            return `${subject}æŠŠ${object}${verb}${preposition}${location}`;
        }
        
        // ç”Ÿæˆé”™è¯¯å¥å­
        function generateWrongSentence() {
            const errorTypes = ['missing_ba', 'wrong_order', 'wrong_verb', 'missing_location'];
            const errorType = errorTypes[Math.floor(Math.random() * errorTypes.length)];
            
            const subject = subjects[Math.floor(Math.random() * subjects.length)];
            const verb = verbs[Math.floor(Math.random() * verbs.length)];
            const location = locations[Math.floor(Math.random() * locations.length)];
            
            // æ„å»ºå®¾è¯­
            let object = '';
            if (selectedIngredients.length === 1) {
                object = selectedIngredients[0].name;
            } else {
                const names = selectedIngredients.map(ing => ing.name);
                object = names.slice(0, -1).join('ã€') + 'å’Œ' + names[names.length - 1];
            }
            
            switch (errorType) {
                case 'missing_ba': // ç¼ºå°‘"æŠŠ"å­—
                    return `${subject}${object}${verb}åˆ°${location}`;
                case 'wrong_order': // ä¸»è¯­å®¾è¯­é¢ å€’
                    return `${object}æŠŠ${subject}${verb}åˆ°${location}`;
                case 'wrong_verb': // åŠ¨è¯ä¸åˆé€‚
                    const wrongVerbs = ['åƒ', 'çœ‹', 'å¬', 'è¯´', 'æƒ³'];
                    const wrongVerb = wrongVerbs[Math.floor(Math.random() * wrongVerbs.length)];
                    return `${subject}æŠŠ${object}${wrongVerb}åˆ°${location}`;
                case 'missing_location': // ç¼ºå°‘åœ°ç‚¹
                    return `${subject}æŠŠ${object}${verb}äº†`;
                default:
                    return `${subject}æŠŠ${object}${verb}åˆ°${location}`;
            }
        }
        
        // æ•°ç»„éšæœºæ’åº
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // æ·»åŠ åŸæ–™åˆ°ç¢—ä¸­
        function addIngredientToBowl() {
            if (!currentChoice) {
                showFeedback("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå¥å­ï¼", false, 0, 'student');
                return;
            }
            
            if (selectedIngredients.length === 0) {
                showFeedback("è¯·å…ˆé€‰æ‹©åŸæ–™ï¼", false, 0, 'student');
                return;
            }
            
            totalAttempts++;
            updateAttemptCount();
            
            // éªŒè¯å¥å­æ˜¯å¦æ­£ç¡®
            const isCorrect = validateSentence(currentChoice);
            
            if (!isCorrect) {
                showFeedback("å¥å­ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°é€‰æ‹©ï¼", false, 0, 'student');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»æ·»åŠ è¿‡è¿™äº›åŸæ–™
            const alreadyAdded = selectedIngredients.some(ingredient => 
                addedIngredients.some(item => item.id === ingredient.id)
            );
            
            if (alreadyAdded) {
                showFeedback("ä½ å·²ç»æ·»åŠ è¿‡è¿™äº›åŸæ–™ä¸­çš„æŸäº›äº†ï¼Œè¯·é€‰æ‹©å…¶ä»–åŸæ–™ï¼", false, 0, 'student');
                return;
            }
            
            // æ·»åŠ åŸæ–™åˆ°åˆ—è¡¨
            selectedIngredients.forEach(ingredient => {
                addedIngredients.push({
                    ...ingredient,
                    sentence: currentChoice
                });
                
                // åœ¨ç¢—ä¸­æ˜¾ç¤ºåŸæ–™
                addIngredientToBowlVisual(ingredient);
            });
            
            // æ›´æ–°åˆ†æ•°
            correctCount++;
            score += 2; // æ¯æ­£ç¡®ä¸€æ¬¡å¾—2åˆ†
            updateScore();
            updateCorrectCount();
            updateAchievement();
            
            // æ›´æ–°ç»“æœæ–‡æœ¬
            updateResultText();
            
            // æ›´æ–°å·²æ·»åŠ åŸæ–™åˆ—è¡¨
            updateAddedIngredientsList();
            
            // æ›´æ–°è¿›åº¦
            updateProgress();
            
            // æ˜¾ç¤ºæˆåŠŸåé¦ˆ
            showFeedback("å¤ªå¥½äº†ï¼ä½ çš„é€‰æ‹©æ­£ç¡®ï¼+2åˆ†", true, 2, 'student');
            
            // ä¿å­˜å­¦ç”Ÿæ•°æ®åˆ°ç­çº§æ•°æ®
            saveStudentData();
            
            // é‡ç½®é€‰æ‹©
            resetSelection();
        }
        
        // éªŒè¯å¥å­
        function validateSentence(sentence) {
            // åŸºæœ¬éªŒè¯ï¼šå¥å­ä¸èƒ½ä¸ºç©º
            if (!sentence || sentence.trim() === '') {
                return false;
            }
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«"æŠŠ"å­—
            if (!sentence.includes('æŠŠ')) {
                return false;
            }
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«æ‰€æœ‰é€‰æ‹©çš„åŸæ–™
            for (const ingredient of selectedIngredients) {
                if (!sentence.includes(ingredient.name)) {
                    return false;
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«è¡¨ç¤ºä½ç§»çš„åŠ¨è¯
            const displacementVerbs = ['æ”¾', 'åŠ ', 'å€’', 'åˆ‡', 'æ‰“'];
            const hasDisplacementVerb = displacementVerbs.some(verb => sentence.includes(verb));
            
            if (!hasDisplacementVerb) {
                return false;
            }
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«è¡¨ç¤ºåœ°ç‚¹çš„è¯
            const locationWords = ['ç¢—', 'ç›†', 'é‡Œé¢', 'ä¸­', 'é‡Œ', 'ä¸Š', 'ä¸€èµ·', 'ä¸­é—´'];
            const hasLocation = locationWords.some(word => sentence.includes(word));
            
            if (!hasLocation) {
                return false;
            }
            
            return true;
        }
        
        // å°†åŸæ–™æ·»åŠ åˆ°ç¢—ä¸­ï¼ˆè§†è§‰ï¼‰
        function addIngredientToBowlVisual(ingredient) {
            const ingredientInBowl = document.createElement('div');
            ingredientInBowl.className = 'ingredient-in-bowl';
            ingredientInBowl.textContent = ingredient.emoji;
            
            // éšæœºä½ç½®ï¼ˆé¿å…å®Œå…¨é‡å ï¼‰
            const size = 30 + Math.random() * 20;
            const x = 20 + Math.random() * 140;
            const y = 20 + Math.random() * 140;
            
            ingredientInBowl.style.width = `${size}px`;
            ingredientInBowl.style.height = `${size}px`;
            ingredientInBowl.style.left = `${x}px`;
            ingredientInBowl.style.top = `${y}px`;
            ingredientInBowl.style.fontSize = `${size * 0.7}px`;
            ingredientInBowl.style.lineHeight = `${size}px`;
            ingredientInBowl.style.textAlign = 'center';
            ingredientInBowl.style.backgroundColor = ingredient.color;
            ingredientInBowl.style.opacity = '0.9';
            
            bowl.appendChild(ingredientInBowl);
        }
        
        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
        function updateScore() {
            scoreValue.textContent = score;
        }
        
        // æ›´æ–°æ­£ç¡®è®¡æ•°
        function updateCorrectCount() {
            correctCountElement.textContent = correctCount;
        }
        
        // æ›´æ–°å°è¯•è®¡æ•°
        function updateAttemptCount() {
            attemptCountElement.textContent = totalAttempts;
        }
        
        // æ›´æ–°æˆå°±
        function updateAchievement() {
            let currentAchievement = achievements[0];
            
            for (let i = achievements.length - 1; i >= 0; i--) {
                if (score >= achievements[i].minScore) {
                    currentAchievement = achievements[i];
                    break;
                }
            }
            
            achievementDisplay.innerHTML = `<p><strong>å½“å‰æˆå°±ï¼š</strong>${currentAchievement.name}</p>`;
            
            // å¦‚æœè¾¾åˆ°æœ€é«˜æˆå°±ï¼Œæ˜¾ç¤ºç‰¹æ®Šæ¶ˆæ¯
            if (currentAchievement.level === 4) {
                achievementDisplay.innerHTML += `<p style="color: #d32f2f; font-weight: bold;">ğŸ‰ æ­å–œä½ æˆä¸ºé¥ºå­ä¹‹ç‹ï¼ ğŸ‰</p>`;
            }
        }
        
        // æ›´æ–°ç»“æœæ–‡æœ¬
        function updateResultText() {
            if (addedIngredients.length === 0) {
                resultText.textContent = "ç¢—æ˜¯ç©ºçš„ï¼Œè¯·å¼€å§‹æ·»åŠ åŸæ–™...";
                return;
            }
            
            if (addedIngredients.length === 1) {
                resultText.textContent = `ä½ å·²ç»å¼€å§‹è°ƒé…é¥ºå­é¦…äº†ï¼æ·»åŠ äº†${addedIngredients[0].name}ã€‚`;
                return;
            }
            
            if (addedIngredients.length < 5) {
                const ingredientNames = addedIngredients.map(item => item.name).join('ã€');
                resultText.textContent = `ä½ æ­£åœ¨è°ƒé…é¥ºå­é¦…ï¼Œå·²ç»æ·»åŠ äº†ï¼š${ingredientNames}ã€‚`;
                return;
            }
            
            if (addedIngredients.length < 8) {
                const ingredientNames = addedIngredients.map(item => item.name).join('ã€');
                resultText.textContent = `é¥ºå­é¦…è¶Šæ¥è¶Šä¸°å¯Œäº†ï¼å·²ç»æ·»åŠ äº†ï¼š${ingredientNames}ã€‚`;
                return;
            }
            
            // æ‰€æœ‰åŸæ–™éƒ½æ·»åŠ äº†
            resultText.innerHTML = `
                <strong>æ­å–œï¼ä½ å®Œæˆäº†é¥ºå­é¦…è°ƒé…ï¼</strong><br>
                ä½ è°ƒé…çš„é¥ºå­é¦…åŒ…å«ï¼š${addedIngredients.map(item => item.name).join('ã€')}ã€‚<br>
                ç°åœ¨å¯ä»¥å¼€å§‹åŒ…é¥ºå­äº†ï¼<br>
                <span style="color: #d32f2f; font-weight: bold;">æœ€ç»ˆå¾—åˆ†: ${score}</span>
            `;
        }
        
        // æ›´æ–°å·²æ·»åŠ åŸæ–™åˆ—è¡¨
        function updateAddedIngredientsList() {
            if (addedIngredients.length === 0) {
                addedIngredientsList.innerHTML = "è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•åŸæ–™";
                return;
            }
            
            let listHTML = "<ul style='margin-left: 20px;'>";
            addedIngredients.forEach(item => {
                listHTML += `<li><strong>${item.emoji} ${item.name} (${item.pinyin}):</strong> "${item.sentence}"</li>`;
            });
            listHTML += "</ul>";
            
            addedIngredientsList.innerHTML = listHTML;
        }
        
        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            const count = addedIngredients.length;
            const total = ingredients.length;
            const percentage = (count / total) * 100;
            
            progressCount.textContent = `${count}/${total}`;
            progressFill.style.width = `${percentage}%`;
        }
        
        // æ˜¾ç¤ºåé¦ˆä¿¡æ¯
        function showFeedback(message, isCorrect, points, role = 'student') {
            let feedbackElement;
            if (role === 'student') {
                feedbackElement = feedback;
            } else {
                // æ•™å¸ˆç«¯çš„åé¦ˆæš‚æ—¶ä½¿ç”¨alert
                alert(message);
                return;
            }
            
            let feedbackHTML = message;
            if (points > 0) {
                feedbackHTML += ` <span style="color: ${isCorrect ? '#2e7d32' : '#c62828'}; font-weight: bold;">(+${points}åˆ†)</span>`;
            }
            
            feedbackElement.innerHTML = feedbackHTML;
            feedbackElement.className = 'feedback ' + (isCorrect ? 'correct' : 'incorrect');
            
            // 3ç§’åéšè—åé¦ˆ
            setTimeout(() => {
                feedbackElement.style.opacity = '0';
                setTimeout(() => {
                    feedbackElement.className = 'feedback';
                    feedbackElement.style.opacity = '1';
                }, 300);
            }, 3000);
        }
        
        // é‡ç½®é€‰æ‹©
        function resetSelection() {
            // æ¸…é™¤åŸæ–™é€‰æ‹©
            selectedIngredients = [];
            document.querySelectorAll('.ingredient-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // æ¸…é™¤é€‰æ‹©é¢˜é€‰æ‹©
            currentChoice = null;
            document.querySelectorAll('.choice-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // éšè—å·²é€‰æ‹©åŸæ–™æ˜¾ç¤º
            selectedIngredientsDisplay.style.display = 'none';
            
            // éšè—é€‰æ‹©é¢˜åŒºåŸŸ
            multipleChoiceArea.style.display = 'none';
            
            // ç¦ç”¨æ·»åŠ æŒ‰é’®
            addBtn.disabled = true;
        }
        
        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            // æ¸…ç©ºç¢—
            bowl.innerHTML = '';
            
            // æ¸…ç©ºæ·»åŠ çš„åŸæ–™
            addedIngredients = [];
            
            // é‡ç½®åˆ†æ•°
            score = 0;
            correctCount = 0;
            totalAttempts = 0;
            
            // é‡ç½®é€‰æ‹©
            resetSelection();
            
            // æ›´æ–°ç»“æœæ–‡æœ¬
            updateResultText();
            
            // æ›´æ–°å·²æ·»åŠ åŸæ–™åˆ—è¡¨
            updateAddedIngredientsList();
            
            // æ›´æ–°è¿›åº¦
            updateProgress();
            
            // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
            updateScore();
            updateCorrectCount();
            updateAttemptCount();
            updateAchievement();
            
            // ä¿å­˜å­¦ç”Ÿæ•°æ®åˆ°ç­çº§æ•°æ®
            saveStudentData();
            
            // æ˜¾ç¤ºé‡ç½®æ¶ˆæ¯
            showFeedback("æ¸¸æˆå·²é‡ç½®ï¼Œè¯·é‡æ–°å¼€å§‹è°ƒé…é¥ºå­é¦…", true, 0, 'student');
        }
        
        // ä¿å­˜å­¦ç”Ÿæ•°æ®åˆ°ç­çº§æ•°æ®
        function saveStudentData() {
            if (!gameStarted || !studentName || !classCode || !storageSupported) return;
            
            try {
                const studentData = {
                    name: studentName,
                    score: score,
                    correctCount: correctCount,
                    totalAttempts: totalAttempts,
                    addedIngredients: addedIngredients,
                    progress: addedIngredients.length,
                    totalIngredients: ingredients.length,
                    lastUpdated: new Date().toISOString()
                };
                
                // ä»æœ¬åœ°å­˜å‚¨è·å–ç­çº§æ•°æ®
                let classData = JSON.parse(localStorage.getItem(`dumplingClass_${classCode}`)) || {
                    code: classCode,
                    created: new Date().toISOString(),
                    students: {}
                };
                
                // æ›´æ–°å½“å‰å­¦ç”Ÿçš„æ•°æ®
                classData.students[studentName] = studentData;
                
                // ä¿å­˜å›æœ¬åœ°å­˜å‚¨
                localStorage.setItem(`dumplingClass_${classCode}`, JSON.stringify(classData));
            } catch (e) {
                console.error('ä¿å­˜æ•°æ®å¤±è´¥:', e);
            }
        }
        
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½å­¦ç”Ÿæ•°æ®ï¼ˆæ•™å¸ˆç«¯ä½¿ç”¨ï¼‰
        function loadStudentData() {
            if (!classCode || !storageSupported) return;
            
            try {
                const classData = localStorage.getItem(`dumplingClass_${classCode}`);
                
                if (!classData) {
                    noStudentsMsg.textContent = "è¯¥ç­çº§è¿˜æ²¡æœ‰å­¦ç”Ÿæ•°æ®...";
                    noStudentsMsg.style.display = 'block';
                    studentListContainer.innerHTML = '<p id="no-students-msg">è¯¥ç­çº§è¿˜æ²¡æœ‰å­¦ç”Ÿæ•°æ®...</p>';
                    studentCountElement.textContent = '0';
                    completedCountElement.textContent = '0';
                    averageScoreElement.textContent = '0';
                    return;
                }
                
                const parsedData = JSON.parse(classData);
                const students = parsedData.students || {};
                const studentNames = Object.keys(students);
                const studentCount = studentNames.length;
                
                studentCountElement.textContent = studentCount;
                
                if (studentCount === 0) {
                    noStudentsMsg.textContent = "è¯¥ç­çº§è¿˜æ²¡æœ‰å­¦ç”Ÿæ•°æ®...";
                    noStudentsMsg.style.display = 'block';
                    studentListContainer.innerHTML = '<p id="no-students-msg">è¯¥ç­çº§è¿˜æ²¡æœ‰å­¦ç”Ÿæ•°æ®...</p>';
                    completedCountElement.textContent = '0';
                    averageScoreElement.textContent = '0';
                    return;
                }
                
                noStudentsMsg.style.display = 'none';
                
                // è®¡ç®—å®Œæˆçš„å­¦ç”Ÿæ•°å’Œå¹³å‡åˆ†
                let completedCount = 0;
                let totalScore = 0;
                
                // æ¸…ç©ºå­¦ç”Ÿåˆ—è¡¨å®¹å™¨
                studentListContainer.innerHTML = '';
                
                // ä¸ºæ¯ä¸ªå­¦ç”Ÿåˆ›å»ºå¡ç‰‡
                studentNames.forEach(studentName => {
                    const studentData = students[studentName];
                    
                    // æ£€æŸ¥æ˜¯å¦å®Œæˆï¼ˆæ·»åŠ äº†è‡³å°‘5ç§åŸæ–™ï¼‰
                    if (studentData.progress >= 5) {
                        completedCount++;
                    }
                    
                    totalScore += studentData.score || 0;
                    
                    // åˆ›å»ºå­¦ç”Ÿå¡ç‰‡
                    const studentCard = document.createElement('div');
                    studentCard.className = 'student-card';
                    
                    // è®¡ç®—è¿›åº¦ç™¾åˆ†æ¯”
                    const progressPercent = Math.round((studentData.progress / studentData.totalIngredients) * 100);
                    
                    // è·å–å­¦ç”Ÿæ·»åŠ çš„åŸæ–™åˆ—è¡¨
                    let ingredientsList = '';
                    if (studentData.addedIngredients && studentData.addedIngredients.length > 0) {
                        ingredientsList = '<ul>';
                        studentData.addedIngredients.forEach(ingredient => {
                            ingredientsList += `<li><strong>${ingredient.name}:</strong> "${ingredient.sentence}"</li>`;
                        });
                        ingredientsList += '</ul>';
                    } else {
                        ingredientsList = '<p>è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•åŸæ–™</p>';
                    }
                    
                    studentCard.innerHTML = `
                        <div class="student-name">${studentData.name}</div>
                        <div class="score-area">
                            <div class="score-item">
                                <div class="score-value">${studentData.score || 0}</div>
                                <div class="score-label">å¾—åˆ†</div>
                            </div>
                            <div class="score-item">
                                <div class="score-value">${studentData.correctCount || 0}</div>
                                <div class="score-label">æ­£ç¡®å¥å­</div>
                            </div>
                            <div class="score-item">
                                <div class="score-value">${studentData.progress || 0}/${studentData.totalIngredients || ingredients.length}</div>
                                <div class="score-label">åŸæ–™</div>
                            </div>
                        </div>
                        <div class="student-progress">
                            <div class="progress-text">è¿›åº¦: ${studentData.progress || 0}/${studentData.totalIngredients || ingredients.length} (${progressPercent}%)</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                        </div>
                        <div class="student-ingredients">
                            <strong>å·²æ·»åŠ çš„åŸæ–™å’Œå¥å­ï¼š</strong>
                            ${ingredientsList}
                        </div>
                        <div style="font-size: 0.8rem; color: #888; margin-top: 10px;">
                            æœ€åæ›´æ–°: ${new Date(studentData.lastUpdated || Date.now()).toLocaleString()}
                        </div>
                    `;
                    
                    studentListContainer.appendChild(studentCard);
                });
                
                // æ›´æ–°ç­çº§æ¦‚å†µ
                completedCountElement.textContent = completedCount;
                averageScoreElement.textContent = studentCount > 0 ? Math.round(totalScore / studentCount) : 0;
            } catch (e) {
                console.error('åŠ è½½å­¦ç”Ÿæ•°æ®å¤±è´¥:', e);
                showFeedback("åŠ è½½å­¦ç”Ÿæ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®æ ¼å¼", false, 0, 'teacher');
            }
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // å­¦ç”Ÿç«¯äº‹ä»¶ç›‘å¬
            addBtn.addEventListener('click', addIngredientToBowl);
            
            resetBtn.addEventListener('click', resetGame);
            
            // æ•™å¸ˆç«¯äº‹ä»¶ç›‘å¬
            refreshBtn.addEventListener('click', loadStudentData);
            
            clearAllBtn.addEventListener('click', () => {
                if (!storageSupported) {
                    alert("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬åœ°å­˜å‚¨ï¼Œæ— æ³•æ¸…ç©ºæ•°æ®");
                    return;
                }
                
                if (confirm("ç¡®å®šè¦æ¸…ç©ºè¯¥ç­çº§æ‰€æœ‰å­¦ç”Ÿçš„æ•°æ®å—ï¼Ÿè¿™ä¸ªæ“ä½œæ— æ³•æ’¤é”€ã€‚")) {
                    try {
                        const classData = localStorage.getItem(`dumplingClass_${classCode}`);
                        if (classData) {
                            const parsedData = JSON.parse(classData);
                            parsedData.students = {};
                            localStorage.setItem(`dumplingClass_${classCode}`, JSON.stringify(parsedData));
                            loadStudentData();
                        }
                    } catch (e) {
                        console.error('æ¸…ç©ºæ•°æ®å¤±è´¥:', e);
                        alert("æ¸…ç©ºæ•°æ®å¤±è´¥");
                    }
                }
            });
            
            // åˆå§‹æ›´æ–°
            updateResultText();
            updateAddedIngredientsList();
            updateProgress();
            updateScore();
            updateCorrectCount();
            updateAttemptCount();
            updateAchievement();
            
            // æ£€æŸ¥å­˜å‚¨æ”¯æŒå¹¶æ˜¾ç¤ºæç¤º
            if (!storageSupported) {
                const warningDiv = document.createElement('div');
                warningDiv.style.cssText = `
                    background-color: #ff9800;
                    color: white;
                    padding: 10px;
                    border-radius: 5px;
                    margin: 10px 0;
                    text-align: center;
                    font-weight: bold;
                `;
                warningDiv.textContent = 'âš ï¸ æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬åœ°å­˜å‚¨åŠŸèƒ½ï¼Œæ¸¸æˆæ•°æ®å°†æ— æ³•ä¿å­˜ï¼';
                document.querySelector('.container').insertBefore(warningDiv, document.querySelector('.role-selector'));
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', initGame);
        
        // å­¦ç”Ÿç«¯è‡ªåŠ¨ä¿å­˜æ•°æ®ï¼ˆæ¯5ç§’ï¼‰
        setInterval(() => {
            if (gameStarted && isConnected && storageSupported) {
                saveStudentData();
            }
        }, 5000);
        
        // æ•™å¸ˆç«¯è‡ªåŠ¨åˆ·æ–°æ•°æ®ï¼ˆæ¯3ç§’ï¼‰
        setInterval(() => {
            if (teacherView.style.display !== 'none' && classCode && storageSupported) {
                loadStudentData();
            }
        }, 3000);
    </script>
</body>
</html>